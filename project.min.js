var baseUrl=$("meta[name=base]").attr("content"),cloneUrl="",deleteUrl="",linkShareUrl="",idProject=null,projectTypes={PROPC:{editor:"blocklyc.jsp","class":"editor-c-link"},SPIN:{editor:"blocklyc.jsp","class":"editor-c-link"}},simplemde=null;
$(document).ready(function(){simplemde=new SimpleMDE({element:document.getElementById("project-form-description"),hideIcons:["link"],spellChecker:!1});cloneUrl=$(".clone-project").data("href");deleteUrl=$(".delete-project").data("href");linkShareUrl=$("#project-link-share").data("href");window.location.hash&&"#"!==window.location.hash?(loadProject(window.location.hash.substr(1)),$("#project-form-container").addClass("in")):$("#project-table-container").addClass("in");$(window).on("hashchange",function(){window.location.hash&&
"#"!==window.location.hash?showProject(window.location.hash.substr(1)):showTable()});$("#project-form").ajaxForm({beforeSerialize:function(){$("#project-form-description").val(simplemde.value());$("#project-form-description-html").val(simplemde.options.previewRender(simplemde.value()))},success:function(){$(".project-changed:not(.hidden)").remove();var a=$(".project-changed").clone().insertAfter(".project-changed");a.removeClass("hidden");a.delay(5E3).fadeOut(400,function(){a.remove()})}});$("#project-delete").click(function(a){a.preventDefault();
$("#project-delete-confirm").modal("show")});$("#project-delete-confirmed").click(function(){window.location.href=$(".delete-project").attr("href")});$("#project-link-share-enable").click(function(){var a=$("#project-link-share");$(this).prop("checked")?$.post(baseUrl+"projectlink",{id:idProject,action:"share"},function(c){c.success&&(a.val(window.location.origin+linkShareUrl+idProject+"&key="+c["share-key"]),a.focus(),a[0].setSelectionRange(0,a.val().length),a.tooltip(),a.tooltip("show"),$(".not-shared-project").addClass("hidden"),
$(".shared-project").removeClass("hidden"))}):$.post(baseUrl+"projectlink",{id:idProject,action:"revoke"},function(c){c.success&&(a.tooltip("destroy"),a.val(""),$(".not-shared-project").removeClass("hidden"),$(".shared-project").addClass("hidden"))})});$("#project-link-share").click(function(){var a=$("#project-link-share");a[0].setSelectionRange(0,a.val().length)})});
function showTable(){$("#project-table").bootstrapTable("refresh");$("#project-table-container").collapse("show");$("#project-form-container").collapse("hide")}
function showProject(a){$(".sharing").removeProp("checked").parent().removeClass("active");$(".your-project").addClass("hidden");$(".not-your-project").addClass("hidden");$(".not-shared-project").addClass("hidden");$(".shared-project").addClass("hidden");loadProject(a);$("#project-table-container").collapse("hide");$("#project-form-container").collapse("show")}
function loadProject(a){window.idProject=a;var c=$("#project-link-share");c.tooltip("destroy");c.val("");$("#project-link-share-enable").prop("checked",!1);$.get(baseUrl+"rest/shared/project/get/"+a,function(b){b.yours?($(".your-project").removeClass("hidden"),b["share-key"]?($("#project-link-share-enable").prop("checked",!0),c.val(window.location.origin+linkShareUrl+a+"&key="+b["share-key"]),c.tooltip(),$(".shared-project").removeClass("hidden")):$(".not-shared-project").removeClass("hidden")):($(".not-your-project").removeClass("hidden"),
$("#project-form-user").val(b.user));$("#project-form-id").val(b.id);$("#project-form-name").val(b.name);var d=boards[b.board];d||(d=boards.other);$("#project-form-board").val(d);$("#project-form-created").val(b.created);$("#project-form-modified").val(b.modified);simplemde.value(b.description);$("#project-description-html").html(b["description-html"]);b["private"]?$("#project-form-private").prop("checked","checked").parent().addClass("active"):b.shared?$("#project-form-shared").prop("checked","checked").parent().addClass("active"):
$("#project-form-private").prop("checked","checked").parent().addClass("active");d=$("a.open-project-link");d.removeClass("editor-c-link editor-spin-link");d.attr("href",baseUrl+"editor/"+projectTypes[b.type].editor+"?project="+b.id);$(".clone-project").attr("href",cloneUrl+b.id);$(".delete-project").attr("href",deleteUrl+b.id);d.addClass(projectTypes[b.type]["class"])})}
function guid(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()};
